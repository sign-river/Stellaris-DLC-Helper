# Stellaris DLC Helper - å¼€å‘è€…æ–‡æ¡£

## ç›®å½•

- [é¡¹ç›®æ¶æ„](#é¡¹ç›®æ¶æ„)
- [å¼€å‘ç¯å¢ƒæ­å»º](#å¼€å‘ç¯å¢ƒæ­å»º)
- [æ ¸å¿ƒæ¨¡å—è¯´æ˜](#æ ¸å¿ƒæ¨¡å—è¯´æ˜)
- [æµ‹é€Ÿç³»ç»Ÿè¯¦è§£](#æµ‹é€Ÿç³»ç»Ÿè¯¦è§£)
- [æ‰“åŒ…éƒ¨ç½²](#æ‰“åŒ…éƒ¨ç½²)
- [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)
- [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
- [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)

---

## é¡¹ç›®æ¶æ„

### ç›®å½•ç»“æ„

```
Stellaris-DLC-Helper/
â”œâ”€â”€ main.py                 # ç¨‹åºå…¥å£
â”œâ”€â”€ build.py               # æ‰“åŒ…è„šæœ¬
â”œâ”€â”€ config.json            # ç”¨æˆ·é…ç½®
â”œâ”€â”€ pairings.json          # æ–‡ä»¶æ˜ å°„é…ç½®
â”œâ”€â”€ requirements.txt       # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ src/                   # æºä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py         # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ config_loader.py  # é…ç½®åŠ è½½å™¨
â”‚   â”œâ”€â”€ core/             # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ dlc_manager.py      # DLCç®¡ç†
â”‚   â”‚   â”œâ”€â”€ downloader.py       # ä¸‹è½½å™¨
â”‚   â”‚   â”œâ”€â”€ installer.py        # å®‰è£…å™¨
â”‚   â”‚   â”œâ”€â”€ patch_manager.py    # è¡¥ä¸ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ source_manager.py   # å¤šæºç®¡ç†
â”‚   â”‚   â”œâ”€â”€ speed_test.py       # æµ‹é€Ÿæ¨¡å—
â”‚   â”‚   â””â”€â”€ updater.py          # è‡ªåŠ¨æ›´æ–°
â”‚   â”œâ”€â”€ gui/              # ç”¨æˆ·ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ main_window.py      # ä¸»çª—å£
â”‚   â”‚   â”œâ”€â”€ settings_dialog.py  # è®¾ç½®å¯¹è¯æ¡†
â”‚   â”‚   â””â”€â”€ update_dialog.py    # æ›´æ–°å¯¹è¯æ¡†
â”‚   â””â”€â”€ utils/            # å·¥å…·æ¨¡å—
â”‚       â”œâ”€â”€ error_handler.py    # é”™è¯¯å¤„ç†
â”‚       â”œâ”€â”€ logger.py           # æ—¥å¿—ç³»ç»Ÿ
â”‚       â”œâ”€â”€ path_utils.py       # è·¯å¾„å·¥å…·
â”‚       â””â”€â”€ steam_utils.py      # Steamå·¥å…·
â”œâ”€â”€ patches/              # è¡¥ä¸æ–‡ä»¶
â”œâ”€â”€ assets/               # èµ„æºæ–‡ä»¶
â”‚   â””â”€â”€ images/          # å›¾ç‰‡èµ„æº
â”œâ”€â”€ docs/                # æ–‡æ¡£
â””â”€â”€ tools/               # å¼€å‘å·¥å…·
```

### æŠ€æœ¯æ ˆ

- **Python 3.8+**
- **GUIæ¡†æ¶**: CustomTkinter
- **HTTPè¯·æ±‚**: requests
- **æ‰“åŒ…å·¥å…·**: PyInstaller

---

## å¼€å‘ç¯å¢ƒæ­å»º

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/sign-river/Stellaris-DLC-Helper.git
cd Stellaris-DLC-Helper
```

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

### 3. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 4. è¿è¡Œç¨‹åº

```bash
python main.py
```

### 5. å¼€å‘å·¥å…·

æ¨èä½¿ç”¨ VS Code + Python æ‰©å±•ï¼š

```json
// .vscode/settings.json
{
    "python.linting.enabled": true,
    "python.linting.pylintEnabled": true,
    "python.formatting.provider": "black"
}
```

---

## æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. DLC Manager (dlc_manager.py)

**èŒè´£**ï¼šç®¡ç† DLC åˆ—è¡¨ã€è·å– DLC ä¿¡æ¯

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `fetch_dlc_list()`: ä»æœåŠ¡å™¨è·å– DLC åˆ—è¡¨
- `get_dlc_info(dlc_key)`: è·å–ç‰¹å®š DLC ä¿¡æ¯
- `merge_dlc_data()`: åˆå¹¶å¤šæº DLC æ•°æ®

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from src.core import DLCManager

manager = DLCManager()
dlc_list = manager.fetch_dlc_list()
```

### 2. Source Manager (source_manager.py)

**èŒè´£**ï¼šç®¡ç†å¤šä¸ªä¸‹è½½æºï¼Œé€‰æ‹©æœ€ä¼˜æº

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `get_best_download_source()`: æµ‹é€Ÿé€‰æ‹©æœ€ä½³æº
- `measure_speed()`: æµ‹è¯•å•ä¸ªæºçš„é€Ÿåº¦
- `get_download_urls_for_dlc()`: è·å– DLC çš„æ‰€æœ‰ä¸‹è½½URL

**é˜ˆå€¼é…ç½®**ï¼š
```python
# ä¸‰çº§é˜ˆå€¼ç­–ç•¥
THRESHOLDS = {
    "r2": 2.5,           # æµ·å¤–æºï¼šç­›é€‰æœ‰æ¢¯å­ç”¨æˆ·
    "github": 2.5,       # æµ·å¤–æºï¼šç­›é€‰æœ‰æ¢¯å­ç”¨æˆ·
    "domestic_cloud": 3.0,  # å›½å†…äº‘ï¼šé¿å…æ‹¥æŒ¤æ—¶æ®µ
    "gitee": 0.8         # Giteeï¼šç¨³å®šä¿åº•
}
```

### 3. Downloader (downloader.py)

**èŒè´£**ï¼šå¤„ç†æ–‡ä»¶ä¸‹è½½ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `download_file()`: ä¸‹è½½å•ä¸ªæ–‡ä»¶
- `pause()`: æš‚åœä¸‹è½½
- `resume()`: æ¢å¤ä¸‹è½½
- `stop()`: åœæ­¢ä¸‹è½½

**ç‰¹æ€§**ï¼š
- æ–­ç‚¹ç»­ä¼ æ”¯æŒ
- è¿›åº¦å›è°ƒ
- é€Ÿåº¦ç›‘æ§
- é”™è¯¯é‡è¯•

### 4. Updater (updater.py)

**èŒè´£**ï¼šè‡ªåŠ¨æ›´æ–°åŠŸèƒ½

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `check_for_updates()`: æ£€æŸ¥æ›´æ–°
- `fetch_announcement()`: è·å–å…¬å‘Š
- `download_update()`: ä¸‹è½½æ›´æ–°
- `apply_update()`: åº”ç”¨æ›´æ–°

**æ›´æ–°æµç¨‹**ï¼š
```python
# 1. æ£€æŸ¥æ›´æ–°
update_info, announcement = updater.check_for_updates()

# 2. ä¸‹è½½æ›´æ–°
if update_info and update_info.has_update:
    updater.download_update(update_info, progress_callback)

# 3. åº”ç”¨æ›´æ–°
updater.apply_update(update_file_path)
```

---

## æµ‹é€Ÿç³»ç»Ÿè¯¦è§£

### ä¸‰å±‚é€‰æºè®¾è®¡

é‡‡ç”¨ä¸‰å±‚æ™ºèƒ½é€‰æºç­–ç•¥ï¼Œç¡®ä¿ç”¨æˆ·æ€»èƒ½è·å¾—å¯ç”¨çš„ä¸‹è½½æºï¼š

```
ã€ç¬¬ä¸€å±‚ï¼šä¼˜é€‰å¿«é€Ÿæºã€‘ğŸš€
  æµ‹è¯•æ‰€æœ‰æº â†’ é€‰æ‹©è¾¾åˆ°é˜ˆå€¼çš„æœ€å¿«æº
  - R2/GitHub: 2.5 MB/s  â† ç­›é€‰æœ‰æ¢¯å­çš„ç”¨æˆ·
  - å›½å†…äº‘: 3.0 MB/s     â† é¿å¼€æ‹¥æŒ¤æ—¶æ®µ
  - Gitee: ä¸å‚ä¸æ­¤å±‚    â† ä¿ç•™æµ‹é€Ÿå±•ç¤ºï¼Œä½œä¸ºä¿åº•
  
  âœ… æœ‰è¾¾æ ‡æº â†’ è¿”å›æœ€å¿«çš„è¾¾æ ‡æº

ã€ç¬¬äºŒå±‚ï¼šé»˜è®¤æºä¿åº•ã€‘âš ï¸
  âŒ æ‰€æœ‰æºéƒ½ä¸è¾¾æ ‡ â†’ ä½¿ç”¨å›½å†…äº‘
  - é¢å‘å›½å†…ç”¨æˆ·çš„é»˜è®¤é€‰æ‹©
  - é…ç½®é—®é¢˜æ—¶çš„å®‰å…¨é€‰é¡¹
  
  âœ… è¿”å›å›½å†…äº‘

ã€ç¬¬ä¸‰å±‚ï¼šè¿æ¥ä¿åº•ã€‘ğŸ’¾
  âŒ è¿å›½å†…äº‘éƒ½æ— æ³•è¿æ¥ â†’ ä½¿ç”¨Gitee
  - Giteeè™½æ…¢ä½†éå¸¸ç¨³å®š
  - æœ€åçš„å¯é ä¿éšœ
  
  âœ… è¿”å›Gitee
```

### é˜ˆå€¼è®¾è®¡ç†å¿µ

æ¯ä¸ªæºçš„é˜ˆå€¼åæ˜ å…¶ä½¿ç”¨åœºæ™¯ï¼š

| æº | é˜ˆå€¼ | ç†ç”± |
|----|------|------|
| R2/GitHub | 2.5 MB/s | éœ€æ¢¯å­ç”¨æˆ·æ‰èƒ½ç”¨ï¼Œæ‰€ä»¥è®¾é«˜ â†’ ç­›é€‰å‡ºçœŸæ­£æœ‰æ¢¯å­çš„ |
| å›½å†…äº‘ | 3.0 MB/s | å›½å†…é»˜è®¤æºï¼Œä½†å¯èƒ½æ‹¥æŒ¤ â†’ é«˜é˜ˆå€¼ç­›é€‰ç©ºé—²æ—¶æ®µ |
| Gitee | â€”ï¼ˆä¸å‚ä¸ï¼‰ | ä¿åº•æºï¼Œåªè®°å½•é€Ÿåº¦ â†’ ä¸éœ€è¦é˜ˆå€¼åˆ¤æ–­ |

### æµ‹é€Ÿå®ç°

```python
def measure_speed(self, url, description, threshold_mb, 
                 log_callback=None, max_seconds=10.0, 
                 max_bytes=100*1024*1024):
    """
    æµ‹é€Ÿå•ä¸ªURL - é€šè¿‡å®é™…ä¸‹è½½æµ‹è¯•çœŸå®é€Ÿåº¦
    
    å‚æ•°:
        url: æµ‹è¯•URL
        description: æè¿°ä¿¡æ¯
        threshold_mb: é€Ÿåº¦é˜ˆå€¼(MB/s)
                     ç‰¹æ®Šå€¼: -1 è¡¨ç¤ºä¿åº•æºï¼ˆGiteeï¼‰ï¼Œ
                     åªè®°å½•é€Ÿåº¦ä¸åšåˆ¤æ–­
        log_callback: æ—¥å¿—å›è°ƒå‡½æ•°
        max_seconds: æœ€å¤§æµ‹è¯•æ—¶é—´ï¼ˆé»˜è®¤10ç§’ï¼‰
        max_bytes: æœ€å¤§ä¸‹è½½å­—èŠ‚æ•°ï¼ˆé»˜è®¤100MBï¼‰
    
    è¿”å›:
        tuple: (æ˜¯å¦è¾¾æ ‡, é€Ÿåº¦MB/s)
    """
    # 10ç§’å®é™…ä¸‹è½½æµ‹è¯•
    start_time = time.time()
    total_downloaded = 0
    last_report_time = time.time()
    report_interval = 2.0  # æ¯2ç§’æŠ¥å‘Šä¸€æ¬¡
    
    # ä¸‹è½½å¾ªç¯
    for chunk in response.iter_content(chunk_size=64*1024):
        total_downloaded += len(chunk)
        current_time = time.time()
        
        # å®æ—¶è¿›åº¦æŠ¥å‘Š
        if current_time - last_report_time >= report_interval:
            current_speed = (total_downloaded/1024/1024) / (current_time-start_time)
            log_callback(f"æµ‹é€Ÿä¸­... {current_speed:.2f} MB/s")
            last_report_time = current_time
        
        # åœæ­¢æ¡ä»¶
        if current_time - start_time >= max_seconds:
            break
    
    # è®¡ç®—ç»“æœ
    speed_mb = (total_downloaded/1024/1024) / (time.time()-start_time)
    
    # åˆ¤æ–­æ˜¯å¦è¾¾æ ‡
    if threshold_mb < 0:  # ä¿åº•æºï¼ˆGiteeï¼‰
        return True, speed_mb  # åªè®°å½•é€Ÿåº¦ï¼Œæ€»æ˜¯è¿”å›True
    else:
        return speed_mb > threshold_mb, speed_mb  # æ™®é€šæºè¿›è¡Œé˜ˆå€¼åˆ¤æ–­
```

### é€‰æºé€»è¾‘ï¼ˆget_best_download_sourceï¼‰

```python
def get_best_download_source(self, silent=False, log_callback=None):
    """æµ‹é€Ÿé€‰æ‹©æœ€ä½³æºï¼ˆå¸¦ä¸‰å±‚ä¿éšœï¼‰"""
    
    # ç¬¬ä¸€æ­¥ï¼šæµ‹è¯•æ‰€æœ‰æº
    test_results = {}  # {source: (speed, url)}
    domestic_cloud_data = None  # é»˜è®¤æºå¤‡ç”¨
    gitee_data = None  # ä¿åº•æºå¤‡ç”¨
    
    for source_name in ["r2", "github", "domestic_cloud", "gitee"]:
        # æ ¹æ®æºè®¾ç½®ä¸åŒçš„é˜ˆå€¼
        if source_name in ["r2", "github"]:
            threshold = 2.5
        elif source_name == "domestic_cloud":
            threshold = 3.0
        else:  # gitee
            threshold = -1  # ä¿åº•æºï¼Œåªè®°å½•ä¸åˆ¤æ–­
        
        ok, speed = self.measure_speed(url, source_name, threshold)
        
        if source_name == "gitee":
            gitee_data = (speed, url)
        elif source_name == "domestic_cloud":
            domestic_cloud_data = (speed, url)
        
        if ok:  # è¾¾æ ‡æºè®°å½•
            test_results[source_name] = (speed, url)
    
    # ç¬¬äºŒæ­¥ï¼šé€‰æ‹©é€»è¾‘
    if test_results:
        # ç¬¬ä¸€å±‚ï¼šæœ‰è¾¾æ ‡æºï¼Œé€‰æœ€å¿«çš„
        best = max(test_results.items(), key=lambda x: x[1][0])
        return best[0], best[1][0]
    elif domestic_cloud_data:
        # ç¬¬äºŒå±‚ï¼šéƒ½ä¸è¾¾æ ‡ï¼Œç”¨é»˜è®¤æº
        return "domestic_cloud", domestic_cloud_data[1]
    elif gitee_data:
        # ç¬¬ä¸‰å±‚ï¼šè¿é»˜è®¤æºéƒ½æ²¡æ•°æ®ï¼Œç”¨ä¿åº•æº
        return "gitee", gitee_data[1]
    else:
        # æç«¯æƒ…å†µï¼šå®Œå…¨æ— æ³•è¿æ¥
        return "gitee", HARDCODED_FALLBACK_URL
```

### æ™ºèƒ½ç¼“å­˜

```python
class SourceManager:
    def __init__(self):
        self._speed_cache = {}           # {source_name: (speed, timestamp)}
        self._cache_validity = 300       # 5åˆ†é’Ÿæœ‰æ•ˆæœŸ
        self._last_best_source = None    
        self._last_best_timestamp = 0
    
    def get_best_download_source(self, force_retest=False):
        """æµ‹é€Ÿé€‰æ‹©æœ€ä½³æºï¼ˆå¸¦ç¼“å­˜ï¼‰"""
        current_time = time.time()
        
        # æ£€æŸ¥ç¼“å­˜
        if not force_retest and self._last_best_source:
            cache_age = current_time - self._last_best_timestamp
            if cache_age < self._cache_validity:
                # ä½¿ç”¨ç¼“å­˜
                return self._cached_result
        
        # æ‰§è¡Œæµ‹é€Ÿ...
        best_source = self._do_speed_test()
        
        # æ›´æ–°ç¼“å­˜
        self._last_best_source = best_source
        self._last_best_timestamp = current_time
        
        return best_source
```

### é˜²æ­¢å¾ªç¯æµ‹é€Ÿ

åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­çš„é€Ÿåº¦æ£€æµ‹ï¼š

```python
# ä¸¥æ ¼çš„è§¦å‘æ¡ä»¶ï¼ˆANDå…³ç³»ï¼‰
if (not self.download_paused and          # æœªæš‚åœ
    download_duration > 10.0 and          # ä¸‹è½½è¶…è¿‡10ç§’
    display_speed < 0.3 and               # é€Ÿåº¦ < 0.3 MB/s
    downloaded > 5 * 1024 * 1024):        # å·²ä¸‹è½½ > 5MB
    
    slow_speed_count += 1
    
    # è¿ç»­5æ¬¡æ…¢é€Ÿæ‰è§¦å‘
    if slow_speed_count >= 5 and not server_issue_detected:
        # æ¯30ç§’æœ€å¤šæ£€æŸ¥ä¸€æ¬¡
        if current_time - last_server_check >= 30:
            retest_and_switch_source()
```

---

## æ‰“åŒ…éƒ¨ç½²

### å¹³å°å…¼å®¹æ€§

- âœ… Windows 10/11
- âœ… Windows 7 (éœ€è¦ç‰¹æ®Šå¤„ç†)
- âš ï¸ Linux (ç†è®ºæ”¯æŒï¼Œéœ€æµ‹è¯•)
- âš ï¸ macOS (ç†è®ºæ”¯æŒï¼Œéœ€æµ‹è¯•)

### Windows æ‰“åŒ…

#### æ–¹å¼1ï¼šä½¿ç”¨ build.pyï¼ˆæ¨èï¼‰

```bash
python build.py
```

ç”Ÿæˆæ–‡ä»¶ï¼š`dist/Stellaris_DLC_Helper.exe`

#### æ–¹å¼2ï¼šæ‰‹åŠ¨æ‰“åŒ…

```bash
pip install -r requirements-build.txt

pyinstaller --name="Stellaris_DLC_Helper" \
    --onefile \
    --windowed \
    --icon=assets/images/tea_Gray.ico \
    --add-data "assets;assets" \
    --add-data "patches;patches" \
    --add-data "pairings.json;." \
    --hidden-import=customtkinter \
    main.py
```

### æ‰“åŒ…é…ç½®

`build.py` å…³é”®é…ç½®ï¼š

```python
# PyInstaller é…ç½®
a = Analysis(
    ['main.py'],
    pathex=[],
    binaries=[],
    datas=[
        ('assets', 'assets'),
        ('patches', 'patches'),
        ('pairings.json', '.'),
    ],
    hiddenimports=['customtkinter'],
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludes=[],
    win_no_prefer_redirects=False,
    win_private_assemblies=False,
    cipher=None,
    noarchive=False,
)
```

### Windows 7 å…¼å®¹æ€§

éœ€è¦ç‰¹æ®Šå¤„ç† asyncioï¼š

```python
# build.py ä¸­æ·»åŠ 
import sys
if sys.platform == 'win32':
    import asyncio
    asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
```

### å‘å¸ƒæµç¨‹

1. **æ›´æ–°ç‰ˆæœ¬å·**ï¼šä¿®æ”¹ `src/config.py` ä¸­çš„ `VERSION`
2. **æµ‹è¯•ç¨‹åº**ï¼šç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
3. **æ‰“åŒ…ç¨‹åº**ï¼šè¿è¡Œ `python build.py`
4. **æµ‹è¯•EXE**ï¼šåœ¨å¹²å‡€ç¯å¢ƒæµ‹è¯•
5. **ä¸Šä¼ æœåŠ¡å™¨**ï¼š
   ```bash
   # æ›´æ–° version.json
   {
       "version": "1.1.0",
       "download_url": "https://xxx/Stellaris_DLC_Helper_v1.1.0.exe",
       "changelog": "1. ä¼˜åŒ–æµ‹é€Ÿ...\n2. ä¿®å¤..."
   }
   ```
6. **å‘å¸ƒ Release**ï¼šåœ¨ GitHub åˆ›å»º Release

---

## é…ç½®ç®¡ç†

### config.json ç»“æ„

```json
{
    "game_path": "C:/Program Files/Steam/steamapps/common/Stellaris",
    "theme": "light",
    "auto_update": true,
    "download": {
        "chunk_size": 65536,
        "max_retries": 3,
        "timeout": 30
    },
    "sources": {
        "enabled": ["r2", "github", "domestic_cloud", "gitee"],
        "priority": ["r2", "github", "domestic_cloud", "gitee"]
    }
}
```

### é…ç½®åŠ è½½

```python
from src.config_loader import ConfigLoader

config = ConfigLoader()
game_path = config.get('game_path')
config.set('theme', 'dark')
config.save()
```

### å¤šæºé…ç½®

åœ¨ `src/config.py` ä¸­é…ç½®ï¼š

```python
DLC_SOURCES = [
    {
        "name": "r2",
        "url": "https://dlc.dlchelper.top",
        "format": "standard",
        "enabled": True,
        "priority": 1,
        "test_url": "https://dlc.dlchelper.top/test/test2.bin",
        "threshold_mb": 2.5
    },
    # ... å…¶ä»–æºé…ç½®
]
```

---

## é”™è¯¯å¤„ç†

### é”™è¯¯ç±»å‹

```python
ERROR_TYPES = {
    'network': 'ç½‘ç»œè¿æ¥å¤±è´¥',
    'disk': 'ç£ç›˜ç©ºé—´ä¸è¶³',
    'permission': 'æƒé™ä¸è¶³',
    'file': 'æ–‡ä»¶æ“ä½œå¤±è´¥',
    'unknown': 'æœªçŸ¥é”™è¯¯'
}
```

### é”™è¯¯å¤„ç†è£…é¥°å™¨

```python
from src.utils.error_handler import handle_errors

@handle_errors(error_type='network', context='ä¸‹è½½æ–‡ä»¶')
def download_file(url, path):
    # ä¸‹è½½é€»è¾‘
    pass
```

### ç”¨æˆ·å‹å¥½æç¤º

```python
def show_friendly_error(error_type, exception, context=""):
    """æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º"""
    error_messages = {
        'network': {
            'title': 'ç½‘ç»œè¿æ¥å¤±è´¥',
            'message': 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨\n\nå¯èƒ½çš„åŸå› ï¼š\n...'
        },
        # ...
    }
    messagebox.showerror(title, message)
```

---

## å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼

éµå¾ª PEP 8 è§„èŒƒï¼š

```python
# å¥½çš„å‘½å
def download_file(url: str, path: str) -> bool:
    """ä¸‹è½½æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„"""
    pass

# ç±»å‹æ³¨è§£
from typing import List, Dict, Optional

def process_dlc_list(dlcs: List[Dict[str, Any]]) -> Optional[str]:
    pass
```

### æ³¨é‡Šè§„èŒƒ

```python
def complex_function(param1, param2):
    """
    å‡½æ•°ç®€çŸ­æè¿°
    
    è¯¦ç»†æè¿°åŠŸèƒ½å’Œä½¿ç”¨åœºæ™¯...
    
    å‚æ•°:
        param1: å‚æ•°1è¯´æ˜
        param2: å‚æ•°2è¯´æ˜
    
    è¿”å›:
        è¿”å›å€¼è¯´æ˜
    
    å¼‚å¸¸:
        å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸
    
    ç¤ºä¾‹:
        >>> complex_function("test", 123)
        "result"
    """
    pass
```

### Git æäº¤è§„èŒƒ

```bash
# æäº¤æ ¼å¼
<type>(<scope>): <subject>

# ç±»å‹
feat:     æ–°åŠŸèƒ½
fix:      ä¿®å¤bug
docs:     æ–‡æ¡£æ›´æ–°
style:    ä»£ç æ ¼å¼
refactor: é‡æ„
test:     æµ‹è¯•
chore:    æ„å»º/å·¥å…·

# ç¤ºä¾‹
git commit -m "feat(downloader): æ·»åŠ æ–­ç‚¹ç»­ä¼ åŠŸèƒ½"
git commit -m "fix(updater): ä¿®å¤æ›´æ–°å¤±è´¥bug"
git commit -m "docs(readme): æ›´æ–°ä½¿ç”¨è¯´æ˜"
```

### æµ‹è¯•è§„èŒƒ

```python
# tools/test_*.py
import unittest

class TestDownloader(unittest.TestCase):
    def setUp(self):
        """æµ‹è¯•å‰å‡†å¤‡"""
        self.downloader = Downloader()
    
    def test_download_file(self):
        """æµ‹è¯•æ–‡ä»¶ä¸‹è½½"""
        result = self.downloader.download_file(test_url, test_path)
        self.assertTrue(result)
    
    def tearDown(self):
        """æµ‹è¯•åæ¸…ç†"""
        pass

if __name__ == '__main__':
    unittest.main()
```

---

## APIæ–‡æ¡£

### DLCManager API

```python
class DLCManager:
    def fetch_dlc_list(self) -> List[Dict[str, Any]]:
        """è·å–DLCåˆ—è¡¨"""
        
    def get_dlc_info(self, dlc_key: str) -> Optional[Dict[str, Any]]:
        """è·å–ç‰¹å®šDLCä¿¡æ¯"""
```

### SourceManager API

```python
class SourceManager:
    def get_best_download_source(self, 
                                 silent: bool = False,
                                 log_callback: Callable = None,
                                 force_retest: bool = False
                                ) -> Tuple[str, str]:
        """
        æµ‹é€Ÿé€‰æ‹©æœ€ä½³ä¸‹è½½æº
        
        è¿”å›: (æºåç§°, æµ‹è¯•URL)
        """
    
    def measure_speed(self,
                     url: str,
                     description: str,
                     threshold_mb: float,
                     log_callback: Callable = None,
                     max_seconds: float = 10.0
                    ) -> Tuple[bool, float]:
        """
        æµ‹é€Ÿå•ä¸ªURL
        
        è¿”å›: (æ˜¯å¦è¾¾æ ‡, é€Ÿåº¦MB/s)
        """
```

---

## è´¡çŒ®æŒ‡å—

### å¦‚ä½•è´¡çŒ®

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'feat: Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### ä»£ç å®¡æŸ¥

PR éœ€è¦æ»¡è¶³ï¼š
- âœ… é€šè¿‡æ‰€æœ‰æµ‹è¯•
- âœ… éµå¾ªä»£ç è§„èŒƒ
- âœ… åŒ…å«å¿…è¦çš„æ–‡æ¡£
- âœ… æ— æ˜æ˜¾æ€§èƒ½é—®é¢˜

---

## è”ç³»æ–¹å¼

- **GitHub**: https://github.com/sign-river/Stellaris-DLC-Helper
- **Issues**: https://github.com/sign-river/Stellaris-DLC-Helper/issues
- **QQç¾¤**: 1051774780
