# 公告系统快速上手指南

## 🚀 一分钟快速开始

### 服务器端设置（开发者）

1. 在服务器上创建公告文件（与 version.json 同级）：

```bash
# 文件位置
服务器目录/
├── version.json
└── announcement.txt  ← 新建这个文件
```

2. 编写公告内容（UTF-8 编码纯文本）：

```text
📢 重要通知

系统将于明天凌晨 2:00-4:00 进行维护。
维护期间自动更新功能可能暂时不可用。

感谢您的理解与支持！
```

3. 上传到服务器，完成！

### 用户端体验

用户无需任何操作，程序会自动：

1. **启动时**：如果有强制更新或新公告，自动弹窗显示
2. **点击"检查更新"**：显示最新的更新和公告信息

## 📋 三种显示场景

### 场景 1：只有公告，没有更新

```
┌────────────────────────┐
│     📢 系统公告         │
│                        │
│  [公告内容区域]         │
│  支持多行文本           │
│  自动换行               │
│                        │
│             [知道了]    │
└────────────────────────┘
窗口高度：420px
```

### 场景 2：只有更新，没有公告

```
┌────────────────────────┐
│  发现新版本 2.0.0       │
│                        │
│  当前版本: 1.5.0        │
│  最新版本: 2.0.0        │
│                        │
│  [更新日志区域]         │
│                        │
│  [稍后提醒] [立即更新]  │
└────────────────────────┘
窗口高度：460px
```

### 场景 3：更新 + 公告

```
┌────────────────────────┐
│  发现新版本 2.0.0       │
│  当前版本: 1.5.0        │
│  [更新日志区域（较小）]  │
│                        │
│     📢 系统公告         │
│  [公告内容区域（较小）]  │
│                        │
│  [稍后提醒] [立即更新]  │
└────────────────────────┘
窗口高度：600px
```

## 🎨 公告内容建议

### ✅ 推荐格式

```text
📢 [标题]

[主要内容，简洁明了]

[补充说明]

--- [签名]
[日期]
```

### 示例 1：维护通知

```text
📢 系统维护通知

服务器将于 2024-01-20 02:00-04:00 进行维护升级。

维护期间：
• 自动更新功能可能暂时不可用
• 已下载的DLC不受影响

给您带来不便，敬请谅解！
```

### 示例 2：新功能发布

```text
🎉 v2.0.0 重磅更新

新版本已发布，包含以下改进：

✨ 多源下载，速度提升 3 倍
🔧 界面优化，体验更流畅
🐛 修复若干已知问题

欢迎更新体验！
```

### 示例 3：紧急通知

```text
⚠️ 重要提示

由于第三方 API 变更，旧版本可能无法正常使用。

请尽快更新到最新版本以确保功能正常！

--- Stellaris DLC Helper 团队
2024-01-15
```

## 🔧 常见操作

### 发布新公告

```bash
# 编辑 announcement.txt
vim announcement.txt

# 上传到服务器
scp announcement.txt user@server:/path/to/update/
```

用户下次启动或检查更新时会自动看到。

### 移除公告

```bash
# 方法 1：删除文件
rm announcement.txt

# 方法 2：清空内容
echo "" > announcement.txt
```

### 更新公告

直接编辑 announcement.txt 并重新上传即可，立即生效。

## 📊 显示规则

### 自动检查（启动时）

| 有强制更新 | 有公告 | 结果 |
|---------|-------|------|
| ✅ | ✅ | 显示更新对话框（包含公告） |
| ✅ | ❌ | 显示更新对话框 |
| ❌ | ✅ | 显示公告对话框 |
| ❌ | ❌ | 不显示任何对话框 |

### 手动检查（点击按钮）

| 有更新 | 有公告 | 结果 |
|-------|-------|------|
| ✅ | ✅ | 显示更新对话框（包含公告） |
| ✅ | ❌ | 显示更新对话框 |
| ❌ | ✅ | 显示公告对话框 |
| ❌ | ❌ | 提示"已是最新版本" |

## 💡 最佳实践

### ✅ 建议做法

1. **内容简洁**：公告不超过 500 字
2. **使用 emoji**：增强视觉效果（📢 ⚠️ ✨ 🔧 🐛）
3. **及时更新**：重要事项过期后立即移除
4. **结构清晰**：使用换行和列表组织内容
5. **友好语气**：礼貌用语，站在用户角度

### ❌ 避免做法

1. ❌ 公告内容过长（影响阅读体验）
2. ❌ 使用 HTML 标签（不支持渲染）
3. ❌ 包含敏感信息（公告是公开的）
4. ❌ 频繁更改（避免骚扰用户）
5. ❌ 语气生硬（影响用户体验）

## 🧪 测试方法

使用测试脚本验证：

```bash
python tools/test_announcement.py
```

选择测试场景：
- **1** - 只有更新（模拟）
- **2** - 只有公告（模拟）
- **3** - 更新+公告（模拟）
- **4** - 真实检查（连接服务器）

## ❓ 常见问题

### Q: 公告多久生效？
**A:** 立即生效。用户下次启动或检查更新时会看到。

### Q: 可以设置公告过期时间吗？
**A:** 当前版本不支持，需要手动移除过期公告。

### Q: 公告支持超链接吗？
**A:** 可以显示文本链接，但不会变成可点击的超链接。

### Q: 用户可以关闭公告吗？
**A:** 可以，点击"知道了"按钮即可关闭。

### Q: 公告会重复显示吗？
**A:** 当前版本会在每次检查更新时显示（如果公告存在）。

## 📚 相关文档

- **详细说明**：`docs/公告系统说明.md`
- **技术实现**：`docs/公告系统实现总结.md`
- **测试脚本**：`tools/test_announcement.py`

---

**更新日期**: 2024-01-15  
**文档版本**: v1.0
