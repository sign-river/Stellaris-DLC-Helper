# 如何确认更新是否成功

## 方法 1：启动时的更新成功提示（推荐）✅

更新成功后，**下次启动程序**时会自动弹出提示框：

```
✅ 更新成功！

原版本：v1.0.0
当前版本：v1.0.1

程序已成功更新到最新版本。
```

这是最直观的确认方式，说明更新已经成功应用。

## 方法 2：查看窗口标题

程序窗口标题会显示当前版本号：

```
Stellaris DLC Helper v1.0.1
```

更新前后对比窗口标题的版本号即可确认。

## 方法 3：查看配置文件

打开程序所在目录的 `config.json` 文件，查看 `version` 字段：

```json
{
  "version": "1.0.1",
  ...
}
```

## 方法 4：查看日志文件

日志文件位于：`Stellaris_DLC_Cache/logs/app_YYYYMMDD.log`

查找日志中的版本信息：
```
日志文件路径: E:\...\Stellaris_DLC_Cache\logs\app_20251201.log
开始应用更新...
备份创建成功: ...
更新应用成功
```

或者查找更新成功的标记：
```
已创建更新标记文件: E:\...\Stellaris_DLC_Cache\update_completed.json
```

## 方法 5：检查更新标记文件（临时）

更新成功后会在缓存目录创建 `update_completed.json` 文件：

**位置：** `Stellaris_DLC_Cache/update_completed.json`

**内容示例：**
```json
{
  "old_version": "1.0.0",
  "new_version": "1.0.1",
  "timestamp": "2025-12-01T12:34:56.789012",
  "success": true
}
```

**注意：** 此文件在程序启动并显示更新成功提示后会自动删除。

## 方法 6：对比文件修改时间

查看程序主 exe 文件的修改时间：
- Windows：右键 `Stellaris-DLC-Helper.exe` → 属性 → 详细信息/修改日期
- 如果修改时间是最近几分钟，说明文件已被更新替换

## 更新流程说明

### 正常更新流程

1. **下载更新包** → 显示下载进度
2. **安装更新** → 显示"正在安装更新..."
3. **显示成功界面** → "✅ 更新完成！"
4. **点击立即重启** → 程序退出并重新启动
5. **启动后显示提示** → "✅ 更新成功！原版本：... 当前版本：..."

### 如果没有看到更新成功提示

可能的原因：

1. **更新标记文件被删除或损坏**
   - 解决方案：查看窗口标题或 config.json 确认版本号

2. **程序异常退出**
   - 解决方案：查看日志文件确认更新是否完成

3. **更新实际失败但未提示**
   - 解决方案：手动点击"检查更新"按钮重新更新

## 常见问题

### Q1: 重启后版本号没有变化？
**可能原因：**
- 更新文件下载失败
- 文件替换失败（被占用）
- 启动了旧版本的程序

**解决方案：**
1. 查看日志文件确认更新过程
2. 检查是否有 `.new` 文件（说明延迟替换失败）
3. 手动删除旧 exe，重命名 `.new` 文件
4. 重新运行更新

### Q2: 更新后程序无法启动？
**可能原因：**
- 更新包损坏
- 文件替换不完整

**解决方案：**
1. 查看 `Stellaris_DLC_Cache/backup/` 目录
2. 找到最新的备份文件夹
3. 手动恢复备份文件

### Q3: 如何验证更新包的完整性？
**方法：**
查看日志中的校验信息：
```
更新包校验失败: 期望 abc123..., 实际 def456...
```
或者
```
更新包下载完成: ...
```

## 开发测试说明

### 模拟更新成功

手动创建更新标记文件进行测试：

```python
import json
from pathlib import Path

marker = Path("Stellaris_DLC_Cache/update_completed.json")
marker.parent.mkdir(parents=True, exist_ok=True)

data = {
    "old_version": "1.0.0",
    "new_version": "1.0.1",
    "timestamp": "2025-12-01T12:00:00",
    "success": True
}

with open(marker, 'w', encoding='utf-8') as f:
    json.dump(data, f, indent=2, ensure_ascii=False)
```

然后重新启动程序，应该会看到更新成功提示。

### 清除更新标记

如果需要清除测试标记：

```bash
# Windows PowerShell
Remove-Item "Stellaris_DLC_Cache\update_completed.json" -ErrorAction SilentlyContinue
```
